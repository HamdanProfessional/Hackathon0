# WhatsApp Manager - Forms and Templates

## Action File Template

Every WhatsApp message with keywords generates a markdown file in `Needs_Action/`:

```markdown
---
type: whatsapp_message
source: whatsapp_manager
priority: high
status: pending
created: 2026-01-11T16:30:00Z
---

# WhatsApp Message Detected

## From: +92 300 2543640

## Message Preview

+92 300 2543640
15:44
Help
3

## Detected Keywords

help

## Suggested Actions

- [ ] Review the message context
- [ ] Determine response needed
- [ ] Draft reply or action plan
- [ ] Move to /Plans/ if complex
- [ ] Respond via WhatsApp or other channel

## Note

This is a message preview from the chat list. Open WhatsApp to see the full conversation and respond.

---
*Generated by WhatsApp Manager*
```

## Keyword Patterns

### Default Keywords

| Keyword | Use Case | Priority |
|---------|----------|----------|
| `urgent` | Time-sensitive requests | High |
| `asap` | Immediate action needed | High |
| `invoice` | Billing discussions | Medium |
| `payment` | Payment conversations | Medium |
| `help` | Support requests | Medium |
| `watch` | Link sharing (YouTube, etc.) | Low |

### Adding Custom Keywords

Edit `watchers/whatsapp_watcher_simple.py` line 35:

```python
KEYWORDS = ['urgent', 'asap', 'invoice', 'payment', 'help', 'watch',
            'meeting', 'contract', 'proposal']  # Add your keywords
```

## Scan Modes

### One-Time Scan

```bash
cd watchers
python whatsapp_watcher_simple.py --vault . --session ../whatsapp_session
```

**Use Case**: Manual check when expecting important messages

### Scheduled Scans

**Windows Task Scheduler** (every 15 minutes):
```batch
schtasks /create /tn "WhatsApp Scan" /tr "python watchers\whatsapp_watcher_simple.py --vault . --session ..\whatsapp_session" /sc minute /mo 15
```

**Mac/Linux Cron** (every 15 minutes):
```bash
*/15 * * * * cd /path/to/vault/watchers && python whatsapp_watcher_simple.py --vault . --session ../whatsapp_session
```

## Session Management

### First-Time Setup

1. **Launch Chrome with debugging** (see reference.md)
2. **Run watcher** - it will open WhatsApp Web
3. **Scan QR code** with your phone
4. **Session saved** for future runs

### Session Location

Default: `../whatsapp_session` (relative to watchers folder)

Change with:
```bash
python whatsapp_watcher_simple.py --session /custom/path/session
```

## Response Templates

### Urgent Message Response

```markdown
## Response Plan

**Acknowledge immediately**:
"Received your message. Looking into this now."

**Assessment**:
- Priority: High
- Response time: Within 1 hour
- Action needed: [specific action]
```

### Invoice Discussion Response

```markdown
## Invoice Response

**Information needed**:
- Invoice number
- Amount in question
- Services covered

**Next steps**:
- [ ] Review invoice details
- [ ] Confirm payment status
- [ ] Send clarification if needed
```

### Help Request Response

```markdown
## Support Request

**Categorize**:
- Technical issue
- Account question
- Feature request
- Other: [specify]

**Action**:
- [ ] Acknowledge receipt
- [ ] Investigate issue
- [ ] Provide solution or workaround
- [ ] Follow up for confirmation
```

## Deduplication Strategy

### Hash-Based Deduplication

```python
content_hash = hash(f"{sender}_{content[:50]}")
filename = f"WHATSAPP_{content_hash % 100000}.md"
```

**Benefits**:
- Same message from same sender = same hash
- Prevents duplicate action files
- Consistent filenames for same content

### Handling Duplicates

**Option 1: Skip if exists**
```python
if filepath.exists():
    logger.debug("Action file already exists")
    return None
```

**Option 2: Update timestamp**
```python
if filepath.exists():
    # Update 'created' timestamp
    # Add new detection entry
```

## Error Handling Forms

### QR Code Required

**Scenario**: Session not found or expired

**Action**:
```bash
# Stop existing Chrome processes
taskkill /F /IM chrome.exe

# Restart with debugging
chrome.exe --remote-debugging-port=9222 --user-data-dir="C:\ChromeDebug"

# Re-run watcher
python watchers/whatsapp_watcher_simple.py --vault . --session ../whatsapp_session
```

### No Messages Found

**Scenario**: Scan completes with 0 messages

**Possible causes**:
1. No messages with keywords in visible chats
2. WhatsApp not fully loaded
3. Incorrect keyword list
4. Session not authenticated

**Verification steps**:
```bash
# 1. Check WhatsApp is open
# 2. Verify you see chat list
# 3. Look for messages with keywords manually
# 4. Check scan logs for errors
```

### Encoding Issues

**Scenario**: Garbled text or emoji issues

**Solution**: Script uses UTF-8 encoding automatically. If issues persist:

```python
# In whatsapp_watcher_simple.py, ensure:
content = f"""..."""
filepath.write_text(content, encoding='utf-8')  # Line 155
```

## Integration Workflows

### Workflow 1: Daily WhatsApp Check

**Every morning at 9 AM**:
1. Scan WhatsApp for overnight messages
2. Create action files for keyword matches
3. Process during daily review

### Workflow 2: On-Demand Scan

**Before meetings**:
1. Run manual scan
2. Check for urgent/client messages
3. Prepare talking points

### Workflow 3: Keyword-Specific Monitoring

**For campaigns**:
1. Add campaign-specific keyword
2. Run scans hourly during campaign
3. Aggregate responses in summary
