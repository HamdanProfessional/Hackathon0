---
name: xero-manager
description: Monitor Xero accounting system for financial events requiring action. Detects invoices, payments, and overdue accounts through Xero MCP server integration.
license: Apache-2.0
---

# Xero Manager

## Purpose

**Detect and Alert** on important Xero accounting events automatically. The Xero Manager **monitors** your Xero account for invoices, payments, and unusual transactions, **creating** action files in your Obsidian vault for financial review.

This skill enables your AI Employee to **proactively monitor** financial health 24/7, **extract** accounting data, and **trigger** appropriate workflows without manual checking.

## Design Philosophy

### Core Principles

1. **MCP-Based Monitoring**: Uses Xero MCP server for secure data access
2. **OAuth2 Authentication**: Secure token-based authentication (no password storage)
3. **Event Filtering**: Detects overdue payments, new invoices, unusual expenses
4. **Human-in-the-Loop**: Creates action files for review rather than auto-processing
5. **Audit Trail**: All financial events logged for compliance

### Architecture

```
Xero Accounting System
      ↓
Xero MCP Server (stdio)
      ↓
Xero Watcher (Python)
      ↓
Filter (overdue/new/unusual)
      ↓
Extract Financial Data
      ↓
Create Action File (.md)
      ↓
Accounting/ Folder
      ↓
Claude Processes
```

### Modularity

- **Separation of Concerns**: Authentication → Query → Filter → Extract → Action
- **Configurable Thresholds**: Easy to customize overdue days, expense limits
- **Token Management**: Secure credential storage and refresh
- **Integration Points**: Works with CEO Briefing and Accounting workflows

## Workflow

### 1. Authenticate Phase

**Setup Xero OAuth2 credentials**:
- Create Xero developer account
- Generate OAuth2 credentials (CLIENT_ID, CLIENT_SECRET)
- Set redirect URI
- Save credentials locally (never committed)

**Token refresh**:
- Automatic token refresh on expiration
- Secure credential storage via .env file
- No password storage required

### 2. Query Phase

**Monitor for financial events**:
```python
# Check for overdue invoices
overdue = xero.Invoices.filter(Status='AUTHORISED', Date_IsBefore__DateTime=today)

# Check for unusual expenses
expenses = xero.Expenses.filter(Amount__gt=500)
```

**Xero data types**:
- Invoices (Accounts Receivable/Payable)
- Payments (Received/Made)
- Expenses (Operating/Capital)
- Bank Transactions
- Credit Notes
- Purchase Orders

### 3. Extract Phase

**Parse financial data**:
- Invoice Number
- Amount (subtotal, tax, total)
- Due Date
- Contact (customer/supplier)
- Status (paid, overdue, draft)
- Payment Terms
- Line Items

**Generate summary**:
- Financial health assessment
- Overdue aging report
- Cash flow analysis
- Action recommendations

### 4. Action Phase

**Generate** markdown action file:
```markdown
---
type: xero_invoice
action: follow_up
priority: high
status: pending_approval
created: 2026-01-11T17:00:00Z
---

# Overdue Invoice Detected

## Invoice Details
**Invoice Number:** INV-001
**Amount:** $1,500.00
**Due Date:** 2026-01-05
**Days Overdue:** 6 days
**Contact:** Client A (client@example.com)

## Action Required
- [ ] Contact client for payment
- [ ] Send payment reminder via email
- [ ] Update payment status in Xero
- [ ] Consider late fee if applicable

## Context
Invoice is 6 days overdue. Immediate follow-up recommended.

---

*Generated by Xero Watcher (MCP)*
```

**Organize** in vault:
- Save to `Accounting/INVOICE_*.md` or `XERO_*.md`
- Track processed invoice IDs
- Ready for Claude processing

## Usage

```bash
# First-time setup (requires Xero MCP server)
# Start Xero MCP server
cd mcp-servers/xero-mcp
npm start

# Run watcher once for testing
python -m watchers.xero_watcher_mcp --vault AI_Employee_Vault --once

# Run continuously via PM2
pm2 start xero-watcher

# Run in dry-run mode
python -m watchers.xero_watcher_mcp --vault AI_Employee_Vault --dry-run
```

## Monitored Events

### Invoices

- **New Invoices**: Issued and received invoices
  - Accounts Receivable (money owed to you)
  - Accounts Payable (money you owe)
  - Draft invoices (not yet sent)
  - Approved invoices (sent/awaiting payment)

- **Overdue Payments**: Payments overdue by >7 days
  - 1-7 days overdue: Medium priority
  - 8-14 days overdue: High priority
  - 15+ days overdue: Urgent priority
  - Automatic aging calculations

- **Unusual Expenses**: Expenses exceeding thresholds
  - Single expenses > $500 (configurable)
  - Recurring expenses increasing >20%
  - New vendors/suppliers
  - Uncategorized transactions

### Payments

- **Payment Received**: Incoming payment notifications
  - Customer payments
  - Refunds received
  - Bank deposits

- **Payment Made**: Outgoing payment tracking
  - Supplier payments
  - Employee reimbursements
  - Tax payments

### Reporting

- **Profit & Loss**: Monthly P&L statements
- **Cash Flow**: Cash position analysis
- **Aging Report**: Overdue invoice aging
- **Budget vs Actual**: Performance comparison

## Output Format

### Action Files

`Accounting/INVOICE_*.md` or `XERO_*.md` containing:
- Invoice/payment details
- Amount and due date
- Contact information
- Action required (follow up, record, etc.)
- Days overdue
- Priority assessment

### Summary Reports

`Accounting/Xero_Summary_YYYY-MM-DD.md` containing:
- Total outstanding invoices
- Total overdue amount
- Cash position
- Unusual expenses list
- Action recommendations

## Scalability

### Current Capabilities

- **Checks**: Every 60 minutes (configurable)
- **Invoices**: Tracks all invoices in Xero
- **Thresholds**: Configurable expense limits
- **Rate Limits**: Respects Xero API quota

### Scaling Options

1. **Real-Time Monitoring**: Use Xero webhooks (future)
2. **Advanced Filtering**: Add custom filter rules
3. **Batch Processing**: Process multiple invoices at once
4. **Automated Reminders**: Send payment reminders via email
5. **Multi-Currency**: Support for international transactions

## Maintainability

### Key Configuration Points

```python
# Xero watcher configuration
class XeroWatcherMCP(BaseWatcher):
    # Monitoring thresholds
    OVERDUE_DAYS = 7  # Days before marked overdue
    UNUSUAL_EXPENSE_THRESHOLD = 500  # Amount threshold

    # Check interval
    CHECK_INTERVAL = 3600  # Seconds (1 hour)
```

### Error Handling

- **Token Expired**: Automatic refresh with retry
- **API Quota Exceeded**: Exponential backoff and retry
- **Network Timeout**: Graceful degradation and retry
- **Authentication Failed**: Clear instructions to re-authenticate
- **MCP Connection Failed**: Logs error, continues monitoring

## Action-Driven Verbs

**Monitor** Xero accounting system
**Detect** overdue invoices and payments
**Extract** financial data and metadata
**Filter** by amount, date, status
**Create** action files for review
**Organize** invoices by customer and date
**Prioritize** urgent follow-ups
**Track** processed invoice IDs
**Log** all financial events
**Generate** financial summaries
**Identify** unusual expenses
**Aggregate** financial metrics
**Alert** on overdue payments
**Report** on cash position

## Integration Points

### Input Sources

- **Xero API**: https://api.xero.com
- **Xero MCP Server**: `mcp-servers/xero-mcp/`
- **OAuth2 Credentials**: CLIENT_ID, CLIENT_SECRET
- **Environment Variables**: `.env` file (XERO_CLIENT_ID, XERO_CLIENT_SECRET)

### Output Destinations

- **Accounting/**: Financial action files
- **Logs/**: Daily JSON logs of detected events
- **Briefings/**: CEO financial summaries
- **Business_Goals.md**: Progress tracking

### Related Skills

- **Accounting**: Process financial reports
- **Approval Manager**: Approve payment actions
- **Weekly Briefing**: Include financials in CEO briefings
- **Email Manager**: Send payment reminders
- **Content Generator**: Generate invoice emails

## Security Considerations

### Credential Management

- **OAuth2**: Secure token-based authentication
- **Token Storage**: Credentials in `.env` (never committed)
- **Token Refresh**: Automatic refresh on expiration
- **No Passwords**: Never stores Xero password

### Audit Logging

All Xero monitoring actions are logged to `Logs/YYYY-MM-DD.json`:
- Timestamp of check
- Invoices detected
- Actions taken
- Errors encountered
- API calls made

## Troubleshooting

### Xero MCP Server Not Running

**Problem**: `HTTPConnectionPool - Connection refused`

**Solution**:
```bash
# Start Xero MCP server
cd mcp-servers/xero-mcp
npm install
npm start
```

### Authentication Failed

**Problem**: `invalid_auth` or `unauthorized`

**Solution**:
1. Verify CLIENT_ID and CLIENT_SECRET in `.env`
2. Check redirect URI matches Xero app settings
3. Re-authenticate with Xero OAuth flow
4. Clear old tokens and re-run

### No Invoices Detected

**Problem**: Watcher runs but finds no invoices

**Solution**:
1. Check Xero account has invoices
2. Verify Xero MCP server is authenticated
3. Check filters (overdue days, thresholds)
4. Run with `--once` flag for debugging
5. Check watcher logs for errors

## Future Enhancements

- [ ] Xero webhook integration (real-time updates)
- [ ] Automated payment reminders via email
- [ ] Multi-currency support
- [ ] Advanced aging reports
- [ ] Budget variance analysis
- [ ] Forecasting and projections
- [ ] Integration with banking APIs
- [ ] Automated reconciliation

## Related Documentation

- **Hackathon0.md**: Overall project architecture
- **mcp-servers/xero-mcp/README.md**: Xero MCP server setup
- **docs/ARCHITECTURE.md**: System architecture details
- **CLAUDE.md**: Project instructions and usage

---

*Last Updated: 2026-01-14*
*Xero Manager Skill v1.1 - Gold Tier Feature*
