---
name: approval-manager
description: Monitor, track, and manage the human-in-the-loop approval workflow for sensitive actions, ensuring proper oversight and audit trails.
license: Apache-2.0
---

# Approval Manager

Monitor, track, and manage the human-in-the-loop approval workflow for sensitive actions, ensuring proper oversight and audit trails.

## Purpose

The Approval Manager skill **monitors** approval queues, **tracks** pending items, **escalates** overdue approvals, **maintains** audit logs, and **ensures** proper human oversight for all sensitive actions. This skill **orchestrates** the decision flow from detection to execution while **maintaining** security and compliance.

This is a **critical security component** of the AI Employee system - no sensitive action (email sending, social posting, payments) can execute without human approval.

## Design Philosophy

### Core Principles

1. **No Auto-Approval**: Sensitive actions always require human review
2. **Traceability**: Every approval decision is logged with timestamp
3. **Time-Aware**: Escalate overdue items automatically
4. **Risk-Based**: Approval requirements match action risk level
5. **Transparent**: Clear status tracking for all items
6. **Audit-First**: Complete audit trail for compliance

### Architecture

```
External System (Gmail/LinkedIn/Xero/etc)
      ↓
Watcher Detects Event
      ↓
Creates Approval Request
      ↓
Pending_Approval/ Folder
      ↓
Human Reviews
      ↓
Moves to Approved/ or Rejected/
      ↓
Approval Monitor Detects
      ↓
Executes Action (if Approved)
      ↓
Logs/ YYYY-MM-DD.json
      ↓
Moves to Done/ (or Rejected/)
```

### Modularity

- **Separation of Concerns**: Detection → Approval → Execution → Logging
- **Risk-Based Categories**: High/Medium/Low priority actions
- **Time-Based Escalation**: Auto-escalate overdue approvals
- **Integration Points**: Works with all watchers and action scripts

## Workflow

### 1. Detection Phase

**Watcher creates approval request**:
```markdown
---
type: approval_request
action: send_email
priority: high
created: 2026-01-11T17:00:00Z
expires: 2026-01-12T17:00:00Z
status: pending_approval
---

# Approval Required: Send Email to Client

## Details
- **To:** client@example.com
- **Subject:** Invoice #1234 - $1,500.00
- **Body:** [Draft email content]

## Risk Assessment
- **Risk Level:** Medium
- **Reversible:** Yes (can send follow-up correction)
- **Requires Approval:** Yes (external communication)

## To Approve
Move this file to `/Approved/` folder.

## To Reject
Move this file to `/Rejected/` folder.

---
*Generated by Gmail Watcher*
```

### 2. Monitoring Phase

**Approval Manager monitors** `/Pending_Approval/`:
- Tracks new approval requests
- Assesses priority and risk level
- Categorizes by action type
- Monitors age of pending approvals

**Priority Assessment**:
- **High**: Payments >$100, new payees, bulk emails
- **Medium**: Routine emails, social posts, calendar changes
- **Low**: Internal notifications, file organization

### 3. Escalation Phase

**Time-based escalation** (per Company_Handbook rules):
- **0-2 hours old**: Normal priority
- **2-6 hours old**: Medium priority (send reminder)
- **6-12 hours old**: High priority (urgent notification)
- **12+ hours old**: Critical (escalate to human)

**Escalation Actions**:
- Create reminder in `/Needs_Action/`
- Send notification (if configured)
- Flag in Dashboard
- Alert via Slack/WhatsApp

### 4. Decision Phase

**Human reviews and decides**:

**Approve**: Move to `/Approved/`
```bash
mv "Pending_Approval/EMAIL_client_20260111.md" "Approved/"
```

**Reject**: Move to `/Rejected/`
```bash
mv "Pending_Approval/EMAIL_client_20260111.md" "Rejected/"
```

**Modify**: Edit file, then move to `/Approved/`
```bash
# Edit file to change content
vim "Pending_Approval/EMAIL_client_20260111.md"
mv "Pending_Approval/EMAIL_client_20260111.md" "Approved/"
```

### 5. Execution Phase

**Approval monitor detects** file in `/Approved/`:
- Reads approval request metadata
- Validates approval is recent (not expired)
- Executes action via appropriate script
- Logs result to audit log
- Moves file to `/Done/` (success) or keeps in `/Approved/` (failure)

### 6. Audit Phase

**All actions logged** to `Logs/YYYY-MM-DD.json`:
```json
{
  "timestamp": "2026-01-11T17:30:00Z",
  "action_type": "email_send",
  "actor": "claude_code",
  "target": "client@example.com",
  "parameters": {
    "subject": "Invoice #1234",
    "approval_file": "EMAIL_client_20260111.md"
  },
  "approval_status": "approved",
  "approved_by": "human",
  "result": "success"
}
```

## Approval Categories

### Email Actions

**Auto-Approve** (low risk):
- Replies to known contacts
- Internal team communications
- Status updates

**Require Approval** (medium/high risk):
- New recipients
- Bulk sends (>5 recipients)
- External communications
- Attachments

### Social Media Actions

**Auto-Approve** (low risk):
- Scheduled posts (pre-approved content)

**Require Approval** (medium/high risk):
- New posts (not pre-scheduled)
- Replies/DMs
- Controversial topics
- Platform-specific restrictions

### Payment Actions

**Require Approval** (always):
- **All** payments to new payees
- Payments >$100 (even known payees)
- Recurring payments
- International transfers

### Calendar Actions

**Auto-Approve** (low risk):
- Personal calendar updates
- Tentative holds

**Require Approval** (medium/high risk):
- Meetings with external attendees
- Recurring meeting creation
- Calendar invites to >5 people

## Risk Assessment Matrix

| Action | Reversible | Impact | Approval Required |
|--------|-----------|--------|-------------------|
| Email to known contact | Yes | Low | No |
| Email to new contact | Yes | Medium | Yes |
| Payment <$50 | Maybe | Medium | Yes |
| Payment >$100 | No | High | Yes |
| Social post (scheduled) | Delete | Low | No |
| Social post (immediate) | Delete | Medium | Yes |
| Calendar invite | Cancel | Low | No |
| File delete | No | High | Yes |

## Integration Points

### Input Sources

- **All Watchers**: Create approval requests
- **Ralph Wiggum**: Creates approval for multi-step tasks
- **Content Generator**: Creates approval for generated content
- **Scripts**: Manual approval request creation

### Output Destinations

- **Approved/**: Ready for execution
- **Rejected/**: Declined actions
- **Done/**: Completed actions
- **Logs/**: Audit trail

### Related Skills

- **All Manager Skills**: Create approval requests
- **All Approval Monitors**: Execute approved actions
- **Weekly Briefing**: Include approval metrics in reports
- **Dashboard**: Show approval queue status

## Security Considerations

### No Bypass Possible

- All approval monitors check `/Approved/` folder only
- No direct execution without file movement
- No environment variable bypass
- No command-line override

### Expiration Handling

- Approval requests expire after 24 hours (configurable)
- Expired requests moved to `/Rejected/` with reason
- Fresh approval required for expired requests

### Audit Trail

- All approvals logged with timestamp
- Human approver tracked (file system user)
- Approval reason preserved in file
- Decision audit trail maintained

## Troubleshooting

### Approval Not Executing

**Problem**: File in `/Approved/` but action not executed

**Solution**:
1. Check approval monitor is running: `pm2 status`
2. Check monitor logs: `pm2 logs email-approval-monitor`
3. Verify file format (YAML frontmatter required)
4. Check for expired approval (created >24 hours ago)

### File Not Moving to Done

**Problem**: Action executed but file stays in `/Approved/`

**Solution**:
1. Check Logs/YYYY-MM-DD.json for execution result
2. Look for error in monitor logs
3. Verify action script completed successfully
4. Manually move to `/Done/` if action succeeded

### Escalation Not Working

**Problem**: Overdue approvals not escalating

**Solution**:
1. Check Company_Handbook.md escalation rules
2. Verify approval monitor checking age
3. Check notification system (Slack/Email)
4. Manually flag in Dashboard if needed

## Usage

```bash
# Check pending approvals
ls AI_Employee_Vault/Pending_Approval/

# Approve an action
mv "Pending_Approval/EMAIL_*.md" "Approved/"

# Reject an action
mv "Pending_Approval/EMAIL_*.md" "Rejected/"

# Check approval status
pm2 status | grep approval

# View approval logs
pm2 logs email-approval-monitor --lines 50

# Check audit log
cat "AI_Employee_Vault/Logs/$(date +%Y-%m-%d).json" | jq '.[] | select(.action_type == "email_send")'
```

## Future Enhancements

- [ ] Web-based approval UI
- [ ] Mobile approval app
- [ ] Multi-level approval chains
- [ ] Approval delegation
- [ ] Notification system (Slack/Email/SMS)
- [ ] Approval analytics dashboard
- [ ] Bulk approval actions
- [ ] Approval comments/feedback
- [ ] Approval withdrawal

## Related Documentation

- **Hackathon0.md**: Overall project architecture
- **docs/ARCHITECTURE.md**: System architecture details
- **CLAUDE.md**: Project instructions and usage
- **AI_Employee_Vault/Company_Handbook.md**: Approval rules and escalation

---

*Last Updated: 2026-01-14*
*Approval Manager Skill v1.1 - Gold Tier Feature*
